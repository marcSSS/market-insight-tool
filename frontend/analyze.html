<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Insight.AI - 开始分析</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <meta name="description" content="Insight.AI - 智能市场洞察分析工具，输入任意网址即可获得深度市场分析报告">
    <meta name="keywords" content="市场分析,AI分析,商业洞察,竞争分析,用户画像">
    <style>
        @keyframes confetti {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
        
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: linear-gradient(45deg, #fbbf24, #f59e0b, #d97706);
            animation: confetti 3s linear forwards;
            z-index: 1000;
        }
        
        @keyframes surprise-bounce {
            0%, 20%, 53%, 80%, 100% { transform: translate3d(0,0,0); }
            40%, 43% { transform: translate3d(0, -30px, 0); }
            70% { transform: translate3d(0, -15px, 0); }
            90% { transform: translate3d(0, -4px, 0); }
        }
        
        .surprise-bounce {
            animation: surprise-bounce 1s ease-in-out;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 to-blue-50">
    <div class="min-h-screen">
            <!-- Header -->
    <header class="bg-white/80 backdrop-blur-sm border-b border-gray-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <a href="test.html" class="flex items-center space-x-3 hover:opacity-80 transition-opacity duration-200">
                    <div class="w-8 h-8 bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg flex items-center justify-center">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                        </svg>
                    </div>
                    <h1 class="text-2xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
                        Insight.AI
                    </h1>
                </a>
                <nav class="hidden md:flex space-x-8">
                    <a href="test.html" class="text-gray-700 hover:text-blue-600 transition-colors">首页</a>
                    <a href="analyze.html" class="text-blue-600 font-semibold">基础分析</a>
                    <a href="analyze_enhanced.html" class="text-gray-700 hover:text-blue-600 transition-colors">增强分析</a>
                </nav>
                
                <!-- Mobile menu button -->
                <button id="mobileMenuBtn" class="md:hidden p-2 rounded-lg hover:bg-gray-100 transition-colors">
                    <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
                
                <!-- Mobile menu -->
                <div id="mobileMenu" class="hidden md:hidden absolute top-full left-0 right-0 bg-white border-b border-gray-200 shadow-lg">
                    <div class="px-4 py-3 space-y-2">
                        <a href="test.html" class="block py-2 text-gray-700 hover:text-blue-600 transition-colors">首页</a>
                        <a href="analyze.html" class="block py-2 text-blue-600 font-semibold">基础分析</a>
                        <a href="analyze_enhanced.html" class="block py-2 text-gray-700 hover:text-blue-600 transition-colors">增强分析</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

        <!-- Main Content -->
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
            <!-- Header Section -->
            <div class="text-center mb-12">
                <h2 class="text-4xl font-bold text-gray-900 mb-4">
                    市场洞察分析
                </h2>
                <p class="text-xl text-gray-600">
                    输入任意网址，我们的AI将为您提供深度的市场分析报告
                </p>
            </div>

            <!-- Analysis Form -->
            <div class="bg-white rounded-xl shadow-lg p-8 mb-8">
                <form id="analysisForm" class="space-y-8">
                    <!-- URL Input -->
                    <div>
                        <label for="url" class="block text-sm font-medium text-gray-700 mb-2">
                            要分析的网址
                        </label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                            </div>
                            <input
                                type="text"
                                id="url"
                                name="url"
                                placeholder="输入网址，如：apple.com"
                                class="block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 hover:border-gray-400"
                                required
                                autocomplete="off"
                                spellcheck="false"
                            />
                        </div>

                    </div>

                    <!-- Analysis Type Selection -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-4">
                            选择分析类型
                        </label>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div class="analysis-type-option relative p-4 border-2 rounded-lg cursor-pointer transition-colors border-blue-500 bg-blue-50" data-type="full">
                                <div class="flex items-start space-x-3">
                                    <div class="p-2 rounded-lg bg-blue-500 text-white">
                                        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                        </svg>
                                    </div>
                                    <div class="flex-1">
                                        <h3 class="font-medium text-gray-900">完整分析</h3>
                                        <p class="text-sm text-gray-600 mt-1">市场趋势、用户画像和竞争分析</p>
                                    </div>
                                    <div class="absolute top-2 right-2">
                                        <div class="w-4 h-4 bg-blue-500 rounded-full flex items-center justify-center">
                                            <div class="w-2 h-2 bg-white rounded-full"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="analysis-type-option relative p-4 border-2 rounded-lg cursor-pointer transition-colors border-gray-200 hover:border-gray-300" data-type="market">
                                <div class="flex items-start space-x-3">
                                    <div class="p-2 rounded-lg bg-green-500 text-white">
                                        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                        </svg>
                                    </div>
                                    <div class="flex-1">
                                        <h3 class="font-medium text-gray-900">市场趋势分析</h3>
                                        <p class="text-sm text-gray-600 mt-1">市场规模、CAGR和关键驱动因素</p>
                                    </div>
                                </div>
                            </div>
                            <div class="analysis-type-option relative p-4 border-2 rounded-lg cursor-pointer transition-colors border-gray-200 hover:border-gray-300" data-type="user">
                                <div class="flex items-start space-x-3">
                                    <div class="p-2 rounded-lg bg-purple-500 text-white">
                                        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path>
                                        </svg>
                                    </div>
                                    <div class="flex-1">
                                        <h3 class="font-medium text-gray-900">用户画像分析</h3>
                                        <p class="text-sm text-gray-600 mt-1">目标用户群体和需求痛点</p>
                                    </div>
                                </div>
                            </div>
                            <div class="analysis-type-option relative p-4 border-2 rounded-lg cursor-pointer transition-colors border-gray-200 hover:border-gray-300" data-type="competitor">
                                <div class="flex items-start space-x-3">
                                    <div class="p-2 rounded-lg bg-orange-500 text-white">
                                        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path>
                                        </svg>
                                    </div>
                                    <div class="flex-1">
                                        <h3 class="font-medium text-gray-900">竞争分析</h3>
                                        <p class="text-sm text-gray-600 mt-1">竞争对手和竞争格局分析</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <div class="pt-6">
                        <button
                            type="submit"
                            id="submitBtn"
                            class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-4 px-8 rounded-xl font-semibold text-lg hover:from-blue-700 hover:to-purple-700 disabled:from-gray-400 disabled:to-gray-500 disabled:cursor-not-allowed transition-all duration-200 flex items-center justify-center shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 disabled:transform-none focus:outline-none focus:ring-4 focus:ring-blue-500/50 active:transform active:scale-95"
                        >
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                            </svg>
                            <span id="submitText">开始分析</span>
                            <svg id="loadingIcon" class="hidden ml-2 animate-spin h-5 w-5 text-white" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                        </button>
                    </div>
                </form>
            </div>

            <!-- Features Preview -->
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">分析内容预览</h2>
                <div class="grid md:grid-cols-3 gap-6">
                    <div class="text-center p-6 border border-gray-200 rounded-lg">
                        <div class="inline-flex p-3 rounded-full bg-blue-100 text-blue-600 mb-4">
                            <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                            </svg>
                        </div>
                        <h3 class="font-semibold text-gray-900 mb-2">市场趋势</h3>
                        <p class="text-sm text-gray-600">
                            市场规模、增长率、驱动因素、行业趋势
                        </p>
                    </div>
                    <div class="text-center p-6 border border-gray-200 rounded-lg">
                        <div class="inline-flex p-3 rounded-full bg-green-100 text-green-600 mb-4">
                            <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path>
                            </svg>
                        </div>
                        <h3 class="font-semibold text-gray-900 mb-2">用户画像</h3>
                        <p class="text-sm text-gray-600">
                            目标用户、需求痛点、行为模式、人口特征
                        </p>
                    </div>
                    <div class="text-center p-6 border border-gray-200 rounded-lg">
                        <div class="inline-flex p-3 rounded-full bg-purple-100 text-purple-600 mb-4">
                            <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path>
                            </svg>
                        </div>
                        <h3 class="font-semibold text-gray-900 mb-2">竞争分析</h3>
                        <p class="text-sm text-gray-600">
                            竞争对手、竞争格局、产品对比、营销策略
                        </p>
                    </div>
                </div>
            </div>

            <!-- Progress Section -->
            <div id="progressSection" class="hidden mt-8 bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">分析进度</h2>
                <div id="progressContent" class="space-y-6">
                    <!-- Progress will be populated here -->
                </div>
            </div>

            <!-- Results Section -->
            <div id="resultsSection" class="hidden mt-8 bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">分析结果</h2>
                <div id="resultsContent" class="space-y-6">
                    <!-- Results will be populated here -->
                </div>
            </div>

            <!-- Upgrade Section -->
            <div id="upgradeSection" class="hidden mt-8">
                <!-- Step 1: Premium Offer -->
                <div id="premiumOffer" class="bg-gradient-to-r from-purple-50 to-blue-50 rounded-xl shadow-lg p-8 border border-purple-200">
                    <div class="text-center">
                        <div class="w-16 h-16 bg-gradient-to-r from-purple-600 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-4">
                            <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                            </svg>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-900 mb-2">🎯 专业增强版分析</h3>
                        <p class="text-gray-600 mb-6 max-w-2xl mx-auto">
                            获得深度战略建议、精准营销机会点、潜在用户洞察等专业级分析报告
                        </p>
                        
                        <!-- Pricing Card -->
                        <div class="bg-white rounded-xl shadow-lg p-6 mb-6 max-w-sm mx-auto">
                            <div class="text-center">
                                <div class="text-3xl font-bold text-gray-900 mb-2">$100</div>
                                <div class="text-sm text-gray-500 mb-4">一次性付费，永久使用</div>
                                <div class="space-y-2 text-sm text-gray-600 mb-4">
                                    <div class="flex items-center">
                                        <svg class="w-4 h-4 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                        </svg>
                                        深度战略分析
                                    </div>
                                    <div class="flex items-center">
                                        <svg class="w-4 h-4 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                        </svg>
                                        营销机会洞察
                                    </div>
                                    <div class="flex items-center">
                                        <svg class="w-4 h-4 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                        </svg>
                                        用户画像深度分析
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex flex-col sm:flex-row gap-4 justify-center">
                            <button onclick="startPayment()" class="inline-flex items-center px-8 py-4 bg-gradient-to-r from-purple-600 to-blue-600 text-white font-semibold rounded-xl hover:from-purple-700 hover:to-blue-700 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
                                </svg>
                                立即支付 $100
                            </button>
                            <button onclick="hideUpgrade()" class="inline-flex items-center px-6 py-3 border-2 border-gray-300 text-gray-700 font-semibold rounded-xl hover:border-gray-400 hover:text-gray-800 transition-all duration-200">
                                继续使用基础版
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Step 2: Payment Processing -->
                <div id="paymentProcessing" class="hidden bg-gradient-to-r from-purple-50 to-blue-50 rounded-xl shadow-lg p-8 border border-purple-200">
                    <div class="text-center">
                        <div class="w-16 h-16 bg-gradient-to-r from-purple-600 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-4 animate-pulse">
                            <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                            </svg>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-900 mb-2">处理支付中...</h3>
                        <p class="text-gray-600 mb-6">正在验证您的支付信息，请稍候</p>
                        <div class="flex justify-center">
                            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"></div>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Surprise Free -->
                <div id="surpriseFree" class="hidden bg-gradient-to-r from-green-50 to-blue-50 rounded-xl shadow-lg p-8 border border-green-200">
                    <div class="text-center">
                        <div class="w-16 h-16 bg-gradient-to-r from-green-600 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-4 animate-bounce">
                            <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-900 mb-2">🎉 惊喜！完全免费！</h3>
                        <p class="text-gray-600 mb-6 max-w-2xl mx-auto">
                            Marc 决定免费提供增强版分析！<br>
                            <span class="text-sm text-green-600 font-medium">💡 这只是一个有趣的用户体验设计 😄</span>
                        </p>
                        <div class="flex flex-col sm:flex-row gap-4 justify-center">
                            <a href="analyze_enhanced.html" class="inline-flex items-center px-8 py-4 bg-gradient-to-r from-green-600 to-blue-600 text-white font-semibold rounded-xl hover:from-green-700 hover:to-blue-700 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                </svg>
                                立即体验增强版
                            </a>
                            <button onclick="hideUpgrade()" class="inline-flex items-center px-6 py-3 border-2 border-gray-300 text-gray-700 font-semibold rounded-xl hover:border-gray-400 hover:text-gray-800 transition-all duration-200">
                                继续使用基础版
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 移动端菜单切换
        document.getElementById('mobileMenuBtn').addEventListener('click', function() {
            const mobileMenu = document.getElementById('mobileMenu');
            mobileMenu.classList.toggle('hidden');
        });

        // 点击外部关闭移动端菜单
        document.addEventListener('click', function(event) {
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            const mobileMenu = document.getElementById('mobileMenu');
            
            if (!mobileMenuBtn.contains(event.target) && !mobileMenu.contains(event.target)) {
                mobileMenu.classList.add('hidden');
            }
        });

        // URL标准化函数
        function normalizeUrl(url) {
            // 去除首尾空格
            url = url.trim();
            
            // 如果为空，返回null
            if (!url) return null;
            
            // 如果已经包含协议，直接返回
            if (url.startsWith('http://') || url.startsWith('https://')) {
                return url;
            }
            
            // 如果没有www前缀，添加
            if (!url.startsWith('www.')) {
                url = 'www.' + url;
            }
            
            // 添加https协议
            return 'https://' + url;
        }

        // 分析类型选择
        document.querySelectorAll('.analysis-type-option').forEach(option => {
            option.addEventListener('click', function() {
                // 移除所有选中状态
                document.querySelectorAll('.analysis-type-option').forEach(opt => {
                    opt.classList.remove('border-blue-500', 'bg-blue-50');
                    opt.classList.add('border-gray-200');
                    const checkmark = opt.querySelector('.absolute');
                    if (checkmark) checkmark.remove();
                });
                
                // 添加选中状态
                this.classList.remove('border-gray-200');
                this.classList.add('border-blue-500', 'bg-blue-50');
                
                // 添加选中标记
                const checkmark = document.createElement('div');
                checkmark.className = 'absolute top-2 right-2';
                checkmark.innerHTML = '<div class="w-4 h-4 bg-blue-500 rounded-full flex items-center justify-center"><div class="w-2 h-2 bg-white rounded-full"></div></div>';
                this.appendChild(checkmark);
            });
        });

        // 键盘快捷键支持
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + Enter 提交表单
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                e.preventDefault();
                document.getElementById('analysisForm').dispatchEvent(new Event('submit'));
            }
            
            // Escape 键关闭移动端菜单
            if (e.key === 'Escape') {
                document.getElementById('mobileMenu').classList.add('hidden');
            }
        });

        // 表单提交
        document.getElementById('analysisForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            let url = document.getElementById('url').value.trim();
            const selectedType = document.querySelector('.analysis-type-option.border-blue-500')?.dataset.type || 'full';
            
            if (!url) {
                alert('请输入要分析的网址');
                return;
            }

            // 智能URL格式处理
            url = normalizeUrl(url);
            if (!url) {
                alert('请输入有效的网址');
                return;
            }

            // 显示加载状态
            const submitBtn = document.getElementById('submitBtn');
            const submitText = document.getElementById('submitText');
            const loadingIcon = document.getElementById('loadingIcon');
            
            // 添加加载动画和禁用状态
            submitBtn.disabled = true;
            submitText.textContent = '分析中...';
            loadingIcon.classList.remove('hidden');
            
            // 添加按钮点击反馈
            submitBtn.classList.add('animate-pulse');
            
            submitBtn.disabled = true;
            submitText.textContent = '分析中...';
            loadingIcon.classList.remove('hidden');

            try {
                console.log('Submitting analysis request:', { url, analysis_type: selectedType });
                // 调用后端API
                const response = await axios.post('http://localhost:8000/api/analyze', {
                    url: url,
                    analysis_type: selectedType
                });

                console.log('Analysis response:', response.data);

                if (response.data.task_id) {
                    // 显示进度监控
                    showProgress(response.data.task_id, url, selectedType);
                    // 开始监控进度
                    monitorProgress(response.data.task_id);
                } else {
                    throw new Error('启动分析任务失败');
                }
            } catch (error) {
                console.error('Analysis error:', error);
                const errorMessage = error.response?.data?.detail || error.message || '分析请求失败，请稍后重试';
                showResults({
                    status: 'error',
                    message: errorMessage,
                    url: url
                });
            } finally {
                // 恢复按钮状态
                submitBtn.disabled = false;
                submitText.textContent = '开始分析';
                loadingIcon.classList.add('hidden');
            }
        });

        // 显示进度
        function showProgress(taskId, url, analysisType) {
            const progressSection = document.getElementById('progressSection');
            const progressContent = document.getElementById('progressContent');
            
            const html = `
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
                    <div class="mb-4">
                        <h3 class="text-lg font-medium text-blue-800 mb-3">分析进行中</h3>
                        <div class="flex justify-between text-sm text-gray-600 mb-2">
                            <span>分析网址: ${url}</span>
                            <span>分析类型: ${getAnalysisTypeName(analysisType)}</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-3">
                            <div id="progressBar" class="bg-gradient-to-r from-blue-600 to-purple-600 h-3 rounded-full transition-all duration-500" style="width: 0%"></div>
                        </div>
                        <div class="flex justify-between text-sm text-gray-600 mt-2">
                            <span id="progressText">正在初始化...</span>
                            <span id="progressPercent">0%</span>
                        </div>
                    </div>
                </div>
            `;
            
            progressContent.innerHTML = html;
            progressSection.classList.remove('hidden');
            
            // 滚动到进度区域
            progressSection.scrollIntoView({ behavior: 'smooth' });
        }

        // 监控进度
        async function monitorProgress(taskId) {
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            const progressPercent = document.getElementById('progressPercent');
            
            let retryCount = 0;
            let lastProgress = 0;
            let stuckTime = 0;
            const maxRetries = 5;
            const maxStuckTime = 30000; // 30秒无进度变化
            
            const checkProgress = async () => {
                try {
                    console.log(`Checking progress for task: ${taskId}`);
                    const response = await axios.get(`http://localhost:8000/api/analysis/${taskId}`);
                    const data = response.data;
                    console.log('Progress response:', data);
                    
                    if (data.status === 'processing') {
                        // 更新进度
                        const progress = data.progress || 0;
                        progressBar.style.width = `${progress}%`;
                        progressPercent.textContent = `${progress}%`;
                        progressText.textContent = data.message || '正在分析...';
                        
                        // 检查是否卡住
                        if (progress === lastProgress) {
                            stuckTime += 1000;
                            if (stuckTime > maxStuckTime) {
                                progressText.textContent = '分析似乎卡住了，正在重新启动...';
                                // 重新启动分析
                                await restartAnalysis(taskId);
                                return;
                            }
                        } else {
                            stuckTime = 0;
                            lastProgress = progress;
                        }
                        
                        // 继续监控
                        setTimeout(checkProgress, 1000);
                    } else if (data.status === 'completed') {
                        // 分析完成，显示结果
                        progressBar.style.width = '100%';
                        progressPercent.textContent = '100%';
                        progressText.textContent = '分析完成！';
                        
                        // 显示详细结果
                        showDetailedResults(data);
                    } else if (data.status === 'failed') {
                        throw new Error(data.message || '分析失败');
                    } else {
                        throw new Error('分析状态异常');
                    }
                } catch (error) {
                    console.error('Progress check error:', error);
                    retryCount++;
                    
                    if (retryCount <= maxRetries) {
                        progressText.textContent = `检查进度时出错，正在重试... (${retryCount}/${maxRetries})`;
                        // 重试机制，延迟递增
                        setTimeout(checkProgress, 2000 * retryCount);
                    } else {
                        // 如果重试次数用完，尝试最后一次获取结果
                        try {
                            const finalResponse = await axios.get(`http://localhost:8000/api/analysis/${taskId}`);
                            const finalData = finalResponse.data;
                            
                            if (finalData.status === 'completed' && finalData.result) {
                                // 分析实际上已经完成，显示结果
                                progressBar.style.width = '100%';
                                progressPercent.textContent = '100%';
                                progressText.textContent = '分析完成！';
                                showDetailedResults(finalData);
                            } else {
                                progressText.textContent = '分析失败，请重试';
                                showRetryButton(taskId, error.message);
                            }
                        } catch (finalError) {
                            progressText.textContent = '分析失败，请重试';
                            showRetryButton(taskId, error.message);
                        }
                    }
                }
            };
            
            // 开始监控
            checkProgress();
        }

        // 重新启动分析
        async function restartAnalysis(taskId) {
            try {
                const response = await axios.post('/api/analyze', {
                    url: document.getElementById('url').value,
                    analysis_type: document.querySelector('.analysis-type-option.border-blue-500')?.dataset.type || 'full'
                });
                
                if (response.data.task_id) {
                    // 更新任务ID并重新开始监控
                    monitorProgress(response.data.task_id);
                }
            } catch (error) {
                console.error('Restart analysis error:', error);
                showRetryButton(taskId, error.message);
            }
        }

        // 显示重试按钮
        function showRetryButton(taskId, errorMessage = '') {
            const progressContent = document.getElementById('progressContent');
            
            // 根据错误类型显示不同的消息
            let displayMessage = '分析过程中遇到了问题，请重试';
            let errorDetail = '';
            
            if (errorMessage) {
                if (errorMessage.includes('429')) {
                    displayMessage = '请求过于频繁，请稍后再试';
                } else if (errorMessage.includes('500')) {
                    displayMessage = '服务器暂时不可用，请稍后再试';
                } else if (errorMessage.includes('NETWORK_ERROR')) {
                    displayMessage = '网络连接失败，请检查网络后重试';
                } else {
                    errorDetail = `<p class="text-sm text-red-500 mb-4">错误详情: ${errorMessage}</p>`;
                }
            }
            
            const retryHtml = `
                <div class="bg-red-50 border border-red-200 rounded-lg p-6">
                    <div class="text-center">
                        <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                            </svg>
                        </div>
                        <h3 class="text-lg font-medium text-red-800 mb-4">分析遇到问题</h3>
                        <p class="text-red-600 mb-4">${displayMessage}</p>
                        ${errorDetail}
                        <div class="flex flex-col sm:flex-row gap-3 justify-center">
                            <button onclick="retryAnalysis()" class="bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 transition-colors font-semibold flex items-center justify-center">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                </svg>
                                重新分析
                            </button>
                            <button onclick="resetForm()" class="bg-gray-600 text-white px-6 py-3 rounded-lg hover:bg-gray-700 transition-colors font-semibold flex items-center justify-center">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"></path>
                                </svg>
                                重新开始
                            </button>
                        </div>
                    </div>
                </div>
            `;
            progressContent.innerHTML = retryHtml;
        }

        // 重置表单
        function resetForm() {
            document.getElementById('progressSection').classList.add('hidden');
            document.getElementById('resultsSection').classList.add('hidden');
            document.getElementById('upgradeSection').classList.add('hidden');
            
            // 重置按钮状态
            const submitBtn = document.getElementById('submitBtn');
            const submitText = document.getElementById('submitText');
            const loadingIcon = document.getElementById('loadingIcon');
            
            submitBtn.disabled = false;
            submitText.textContent = '开始分析';
            loadingIcon.classList.add('hidden');
        }

        // 重试分析
        function retryAnalysis() {
            const url = document.getElementById('url').value;
            const selectedType = document.querySelector('.analysis-type-option.border-blue-500')?.dataset.type || 'full';
            
            if (url) {
                // 重新提交表单
                document.getElementById('analysisForm').dispatchEvent(new Event('submit'));
            }
        }

        // 显示详细结果
        function showDetailedResults(data) {
            const resultsSection = document.getElementById('resultsSection');
            const resultsContent = document.getElementById('resultsContent');
            
            const result = data.result;
            
            const html = `
                <div class="space-y-8">
                    <!-- 分析摘要 -->
                    <div class="bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200 rounded-lg p-6">
                        <h3 class="text-xl font-bold text-gray-900 mb-4">分析摘要</h3>
                        <p class="text-gray-700 leading-relaxed">分析网址: ${result.url}</p>
                        <p class="text-gray-700 leading-relaxed">市场类别: ${result.category}</p>
                        <p class="text-gray-700 leading-relaxed">分析时间: ${new Date(result.analysis_timestamp).toLocaleString()}</p>
                    </div>

                    <!-- 市场趋势 -->
                    <div class="border border-gray-200 rounded-lg p-6">
                        <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
                            <svg class="h-6 w-6 text-blue-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                            </svg>
                            市场趋势分析
                        </h3>
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-semibold text-gray-800 mb-2">市场规模</h4>
                                <div class="bg-gray-50 rounded-lg p-4">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="text-sm text-gray-600">市场规模</span>
                                        <span class="font-bold text-blue-600">${result.market_trends.market_size.value}</span>
                                    </div>
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="text-sm text-gray-600">年复合增长率</span>
                                        <span class="font-bold text-green-600">${result.market_trends.cagr.value}</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-gray-600">置信度</span>
                                        <span class="font-bold text-purple-600">${Math.round(result.market_trends.market_size.confidence * 100)}%</span>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-800 mb-2">关键驱动因素</h4>
                                <div class="space-y-2">
                                    ${result.market_trends.key_drivers.map(driver => 
                                        `<div class="flex items-center text-sm">
                                            <div class="w-2 h-2 bg-blue-500 rounded-full mr-2"></div>
                                            <span>${driver.value}</span>
                                        </div>`
                                    ).join('')}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 用户画像 -->
                    <div class="border border-gray-200 rounded-lg p-6">
                        <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
                            <svg class="h-6 w-6 text-green-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path>
                            </svg>
                            用户画像分析
                        </h3>
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-semibold text-gray-800 mb-2">现有用户</h4>
                                <div class="space-y-3">
                                    <div>
                                        <h5 class="font-medium text-gray-700 mb-1">人口统计</h5>
                                        <p class="text-sm text-gray-600">${result.user_profiles.existing_users.demographics.value}</p>
                                    </div>
                                    <div>
                                        <h5 class="font-medium text-gray-700 mb-1">行为特征</h5>
                                        <p class="text-sm text-gray-600">${result.user_profiles.existing_users.behaviors.value}</p>
                                    </div>
                                    <div>
                                        <h5 class="font-medium text-gray-700 mb-1">痛点</h5>
                                        <div class="space-y-1">
                                            ${result.user_profiles.existing_users.pain_points.map(pain => 
                                                `<div class="flex items-center text-sm">
                                                    <div class="w-2 h-2 bg-red-500 rounded-full mr-2"></div>
                                                    <span>${pain.value}</span>
                                                </div>`
                                            ).join('')}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-800 mb-2">潜在用户</h4>
                                <div class="space-y-3">
                                    <div>
                                        <h5 class="font-medium text-gray-700 mb-1">人口统计</h5>
                                        <p class="text-sm text-gray-600">${result.user_profiles.potential_users.demographics.value}</p>
                                    </div>
                                    <div>
                                        <h5 class="font-medium text-gray-700 mb-1">行为特征</h5>
                                        <p class="text-sm text-gray-600">${result.user_profiles.potential_users.behaviors.value}</p>
                                    </div>
                                    <div>
                                        <h5 class="font-medium text-gray-700 mb-1">痛点</h5>
                                        <div class="space-y-1">
                                            ${result.user_profiles.potential_users.pain_points.map(pain => 
                                                `<div class="flex items-center text-sm">
                                                    <div class="w-2 h-2 bg-orange-500 rounded-full mr-2"></div>
                                                    <span>${pain.value}</span>
                                                </div>`
                                            ).join('')}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 竞争分析 -->
                    <div class="border border-gray-200 rounded-lg p-6">
                        <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
                            <svg class="h-6 w-6 text-purple-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path>
                            </svg>
                            竞争分析
                        </h3>
                        <div class="space-y-4">
                            ${result.competition.top_competitors.map(competitor => `
                                <div class="border border-gray-200 rounded-lg p-4">
                                    <h4 class="font-semibold text-gray-800 mb-2">${competitor.name}</h4>
                                    <div class="grid md:grid-cols-3 gap-4 text-sm">
                                        <div>
                                            <span class="text-gray-600">市场份额:</span>
                                            <span class="font-medium text-blue-600">${competitor.market_share.value}</span>
                                        </div>
                                        <div>
                                            <span class="text-gray-600">网站流量:</span>
                                            <span class="font-medium text-green-600">${competitor.website_traffic.value}</span>
                                        </div>
                                        <div>
                                            <span class="text-gray-600">趋势评分:</span>
                                            <span class="font-medium text-purple-600">${competitor.trends_score.value}</span>
                                        </div>
                                    </div>
                                    <div class="mt-3">
                                        <h5 class="font-medium text-gray-700 mb-1">核心优势:</h5>
                                        <div class="flex flex-wrap gap-2">
                                            ${competitor.core_advantages.map(advantage => 
                                                `<span class="bg-purple-100 text-purple-800 px-2 py-1 rounded text-xs">${advantage.value}</span>`
                                            ).join('')}
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- 战略建议 -->
                    <div class="border border-gray-200 rounded-lg p-6">
                        <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
                            <svg class="h-6 w-6 text-orange-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                            </svg>
                            战略建议
                        </h3>
                        <div class="space-y-4">
                            <div>
                                <h4 class="font-semibold text-gray-800 mb-2">战略总结</h4>
                                <p class="text-gray-700 bg-gray-50 rounded-lg p-3">${result.strategic_recommendations.strategic_summary.value}</p>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-800 mb-2">营销机会点</h4>
                                <div class="space-y-2">
                                    ${result.strategic_recommendations.marketing_opportunities.map(opportunity => 
                                        `<div class="flex items-start">
                                            <div class="flex-shrink-0 w-2 h-2 bg-green-500 rounded-full mr-2 mt-2"></div>
                                            <p class="text-gray-700 text-sm">${opportunity.value}</p>
                                        </div>`
                                    ).join('')}
                                </div>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-800 mb-2">潜在用户机会点</h4>
                                <div class="space-y-2">
                                    ${result.strategic_recommendations.potential_user_opportunities.map(opportunity => 
                                        `<div class="flex items-start">
                                            <div class="flex-shrink-0 w-2 h-2 bg-blue-500 rounded-full mr-2 mt-2"></div>
                                            <p class="text-gray-700 text-sm">${opportunity.value}</p>
                                        </div>`
                                    ).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            resultsContent.innerHTML = html;
            resultsSection.classList.remove('hidden');
            
            // 滚动到结果区域
            resultsSection.scrollIntoView({ behavior: 'smooth' });
            
            // 显示升级引导
            setTimeout(() => {
                document.getElementById('upgradeSection').classList.remove('hidden');
            }, 2000);
        }

        // 开始支付流程
        function startPayment() {
            // 添加按钮点击效果
            const button = event.target.closest('button');
            button.disabled = true;
            button.innerHTML = `
                <svg class="animate-spin w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                </svg>
                处理中...
            `;
            
            // 隐藏第一步，显示支付处理
            document.getElementById('premiumOffer').classList.add('hidden');
            document.getElementById('paymentProcessing').classList.remove('hidden');
            
            // 模拟支付处理过程
            setTimeout(() => {
                // 显示"验证中"状态
                const processingText = document.querySelector('#paymentProcessing p');
                processingText.textContent = '正在验证支付信息...';
            }, 1000);
            
            setTimeout(() => {
                // 显示"处理中"状态
                const processingText = document.querySelector('#paymentProcessing p');
                processingText.textContent = '正在处理您的订单...';
            }, 2000);
            
            // 3秒后显示惊喜
            setTimeout(() => {
                document.getElementById('paymentProcessing').classList.add('hidden');
                document.getElementById('surpriseFree').classList.remove('hidden');
                
                // 添加惊喜效果
                createConfetti();
                
                // 添加震动反馈（如果支持）
                if (navigator.vibrate) {
                    navigator.vibrate([100, 50, 100]);
                }
                
                // 添加惊喜动画
                const surpriseElement = document.getElementById('surpriseFree');
                surpriseElement.classList.add('surprise-bounce');
            }, 3000);
        }
        
        // 创建彩带效果
        function createConfetti() {
            const colors = ['#fbbf24', '#f59e0b', '#d97706', '#10b981', '#059669', '#3b82f6', '#2563eb'];
            
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDelay = Math.random() * 0.5 + 's';
                    document.body.appendChild(confetti);
                    
                    // 清理彩带元素
                    setTimeout(() => {
                        confetti.remove();
                    }, 3000);
                }, i * 50);
            }
        }

        // 隐藏升级引导
        function hideUpgrade() {
            document.getElementById('upgradeSection').classList.add('hidden');
            // 重置所有步骤状态
            document.getElementById('premiumOffer').classList.remove('hidden');
            document.getElementById('paymentProcessing').classList.add('hidden');
            document.getElementById('surpriseFree').classList.add('hidden');
        }

        // 显示结果（错误处理）
        function showResults(data) {
            const resultsSection = document.getElementById('resultsSection');
            const resultsContent = document.getElementById('resultsContent');
            
            const html = `
                <div class="bg-red-50 border border-red-200 rounded-lg p-6">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <svg class="h-5 w-5 text-red-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                        <div class="ml-3">
                            <h3 class="text-sm font-medium text-red-800">分析失败</h3>
                            <div class="mt-2 text-sm text-red-700">
                                <p>${data.message}</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            resultsContent.innerHTML = html;
            resultsSection.classList.remove('hidden');
            
            // 滚动到结果区域
            resultsSection.scrollIntoView({ behavior: 'smooth' });
        }

        // 获取分析类型名称
        function getAnalysisTypeName(type) {
            const types = {
                'full': '完整分析',
                'market': '市场趋势分析',
                'user': '用户画像分析',
                'competitor': '竞争分析'
            };
            return types[type] || type;
        }
    </script>
</body>
</html> 
